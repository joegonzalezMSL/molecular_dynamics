## input to cut a sample from a piston shock and run under NPH
## conditions to allow for evolution behind the shock front
dimension       3
units           metal
atom_style      atomic
boundar         p p p

read_restart    _SAMPLE_

variable        pbar equal _P_*10000
variable        runNPH equal 600000
variable        tstep equal 0.0003
variable        ph string "_PH_"
variable        zCutLow equal 5000
variable        zCutHigh equal 6000

pair_style      pace product
pair_coeff      * * sic-non-uniform-october.yace Si C

neighbor        2.0 bin
neigh_modify    every 1 delay 0 check yes


compute         atom_energy all pe/atom
compute      	  Msd all  msd

timestep        ${tstep}
thermo          2000
thermo_style    custom step time temp pe ke press pxx pyy pzz vol density c_Msd[4]
thermo_modify	  norm yes

dump        	  RDUMP all custom 5000 dumps/${ph}-shocked-_P_GPa-nph-*.xyz id type x y z vx vy vz c_atom_energy

region          middle block EDGE EDGE EDGE EDGE ${zCutLow} ${zCutHigh} units box
group           middleAtoms region middle
group		        otherAtoms subtract all middleAtoms
delete_atoms	  group otherAtoms

change_box      middleAtoms boundary p p s

variable 	      zled equal "zlo+6.0"
variable 	      zhed equal "zhi-6.0"

region		      rzledge block EDGE EDGE EDGE EDGE EDGE ${zled} units box
region		      rzhedge block EDGE EDGE EDGE EDGE ${zhed} EDGE units box

group		        gzl region rzledge
group		        gzh region rzhedge
group		        mobileAtoms subtract all gzl gzh

compute		      zChunks middleAtoms chunk/atom bin/1d z lower 10
compute		      vcmChunks middleAtoms vcm/chunk zChunks

fix		          MOM middleAtoms momentum/chunk 1 zChunks linear 0 0 1

run 		        1
unfix		        MOM

velocity	      gzl zero linear
velocity	      gzh zero linear
fix		          freezeL gzl setforce 0.0 0.0 0.0
fix             freezeH gzh setforce 0.0 0.0 0.0

restart		      50000 nph-trap-restart-*

fix             NVEM mobileAtoms nve
run             10000

unfix		        freezeL
unfix		        freezeH
unfix		        NVEM

change_box      all boundary p p p

fix		          NPH all nph z ${pbar} ${pbar} $(500.0*dt)

run		          ${runNPH}
